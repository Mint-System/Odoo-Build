#!/bin/bash

ODOO_REVISION=18.0.20241125

# Checkout odoo repo
cd odoo && git checkout 9cd3b8559fdba83f6f88f84dc1384e4bcb33bdc1

# Create tag on the odoo repo
git tag -a $ODOO_REVISION -m "$ODOO_REVISION"
cd ..

# Checkout enterprise repo
cd enterprise && git checkout 8b22d1f390e0761a54a83828a782740def85bb64

# Create tag on the enterprise repo
git tag -a $ODOO_REVISION -m "$ODOO_REVISION"
cd ..

# Checkout theme repo
cd themes && git checkout 5ce9cc6f2d112b37307fac2a3e2dd3960272a9b9

# Create tag on the odoo repo
git tag -a $ODOO_REVISION -m "$ODOO_REVISION"
cd ..

# Pull docker image
docker pull "odoo@sha256:55be8055bebb50cc6b9565e30ffb9a522b7c9b7c61a0558b005662ba9f0a06dc"
IMAGE_ID=$(docker image inspect "odoo@sha256:55be8055bebb50cc6b9565e30ffb9a522b7c9b7c61a0558b005662ba9f0a06dc" --format "{{ .ID }}")

# Tag the docker image
docker tag ${IMAGE_ID:7:12} odoo:$ODOO_REVISION