<?xml version="1.0"?>
<data inherit_id="sale.report_saleorder_document" priority="50">

  <xpath expr="//td[@name='td_quantity']" position="replace">
    <t t-set="product" t-value="sum(doc.blanket_order_id.line_ids.filtered(lambda r: r.product_id.id == line.product_id.id).mapped('remaining_uom_qty'))" />

    <td name="td_quantity" class="text-right">
      <span t-field="line.product_uom_qty" />
      <span t-field="line.product_uom" />
      <t t-if="product">
        /
        <span t-esc="'%.3f'%(product)" />
        <span t-field="line.product_uom" />
      </t>
    </td>

  </xpath>

  <xpath expr="//th[@name='th_quantity']" position="replace">
    <th t-if="doc.blanket_order_id" name="th_quantity" class="text-right">Qty / Rem. Agreement Qty</th>
    <th t-if="not doc.blanket_order_id" name="th_quantity" class="text-right">Qty</th>
  </xpath>

</data> 