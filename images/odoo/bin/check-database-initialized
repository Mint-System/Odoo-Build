#!/usr/bin/env bash
set -e

odoo_database=${1:-$ODOO_DATABASE}
odoo_database=${1:-$ODOO_DATABASE}

log-entrypoint "Check if database $odoo_database is initialized..."
database_initialized=$(exec psql "postgres://$PGUSER:$PGPASSWORD@$PGHOST:$PGPORT/$odoo_database" -tAc "SELECT COUNT(*) FROM information_schema.tables WHERE table_name = 'ir_module_module'")

if [[ "$database_initialized" = "1" ]]; then
    log-entrypoint "Database $odoo_database is initialized."
    exit 0
else
    log-entrypoint "Database $odoo_database is not initialized."
    exit 1
fi
