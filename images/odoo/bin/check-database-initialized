#!/usr/bin/env bash
set -e

# Usage: check-database-initialized [database]

database="$DB_NAME"
if [[ -n "$1" ]]; then
    database="$1"
fi

log-entrypoint "Check if database $database is initialized..."
database_initialized=$(exec psql "postgres://$PGUSER:$PGPASSWORD@$PGHOST:$PGPORT/$database" -tAc "SELECT COUNT(*) FROM information_schema.tables WHERE table_name = 'ir_module_module'")

if [[ "$database_initialized" = "1" ]]; then
    log-entrypoint "Database $database is initialized."
    exit 0
else
    log-entrypoint "Database $database is not initialized."
    exit 1
fi
