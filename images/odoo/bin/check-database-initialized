#!/bin/bash

if [ -n "$ODOO_DATABASE" ]; then
    echo "Check if database $ODOO_DATABASE is initialized."
    DATABASE_INITIALIZED=$(exec psql "postgres://$PGUSER:$PGPASSWORD@$PGHOST:$PGPORT/$ODOO_DATABASE" -tAc "SELECT COUNT(*) FROM information_schema.tables WHERE table_name = 'ir_module_module'")
    echo "Database initialization check result: $DATABASE_INITIALIZED"

    if [ "$DATABASE_INITIALIZED" = "1" ]; then
        echo "Database $ODOO_DATABASE is initialized."
        exit 0
    else
        echo "Database $ODOO_DATABASE is not initialized."
        exit 1
    fi
else
    echo "ODOO_DATABASE environment variable not set."
    exit 1
fi
