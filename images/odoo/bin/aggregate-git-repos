#!/usr/bin/env bash
set -e

if [[ -n "$GIT_AUTHOR_NAME" ]]; then
    log-entrypoint "Set git config user.name to '$GIT_AUTHOR_NAME'."
    git config --global user.name "$GIT_AUTHOR_NAME"
fi

if [[ -n "$GIT_AUTHOR_EMAIL" ]]; then
    log-entrypoint "Set git config user.email to '$GIT_AUTHOR_EMAIL'."
    git config --global user.email "$GIT_AUTHOR_EMAIL"
fi

if [[ -f "/var/lib/odoo/git/repos.yml" ]]; then
    cd /var/lib/odoo/git
    log-entrypoint 'Aggregate git repos...'
    gitaggregate -c repos.yml --expand-env
elif [[ -f "/var/lib/odoo/git/repos.yaml" ]]; then
    cd /var/lib/odoo/git
    log-entrypoint 'Aggregate git repos...'
    gitaggregate -c repos.yaml --expand-env
else
    log-entrypoint 'File /var/lib/odoo/git/repos.y(a)ml not found.'
fi
